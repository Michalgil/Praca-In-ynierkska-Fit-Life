<div class="image" style="width: 100vw; height: 100vh; position: fixed; top:20;  left: 0;">

</div>

<div *ngIf="showComponent">

  <div *ngIf="formError" class="alert alert-danger" role="alert">
    Bład przy wprowadzaniu danych, wypełnij dane raz jeszcze !
  </div>

  <form [formGroup]="dietForm" (ngSubmit)="createDiet()">

    <div *ngIf="!dietExists">
      <div class="row">
        <div class="col-xl-7 offset-xl-4">
          <h1 style="color:white; font-size: 70px">Formularz diety</h1>
        </div>
      </div>
      <div class="form-group" class="col-xl-7 offset-xl-3" style="margin-top: 80">
        <label for="weight" style="color: white">Waga</label>
        <input type="number" class="form-control" placeholder="Waga w kg" formControlName="weight" required>
      </div>
      <div class="form-group" class="col-xl-7 offset-xl-3" style="margin-top: 15px">
        <label for="height" style="color: white">Wzrost</label>
        <input type="number" class="form-control" placeholder="Wzrost w cm" formControlName="height" required>
      </div>
      <div class="form-group" class="col-xl-7 offset-xl-3" style="margin-top: 15px">
        <label for="age" style="color: white">Wiek</label>
        <input type="number" class="form-control" placeholder="Wiek" formControlName="age" required>
      </div>
      <div class="form-group" class="col-xl-7 offset-xl-3" style="margin-top: 15px">
        <label style="color: white">Aktywność fizyczna w ciągu dnia</label>
        <select class="custom-select" formControlName="dailyActivity" required>
          <option value="1">Sporadyczna (brak ćwiczeń, praca siedząca,uczeń)</option>
          <option value="1.2">Mała (2 razy w tygodniu ćwiczenia, praca lekka, uczeń)</option>
          <option value="1.3">Normalna (2-3 razy w tygodniu ćwiczenia, praca lekka,uczen)</option>
          <option value="1.4">Duza (3-4 razy w tygodniu ćwiczenia, praca fizyczna)</option>
          <option value="1.6">Bardzo duża (4-6 razy w tygodniu ćwiczenia, praca fizyczna)</option>
        </select>
      </div>
      <div class="form-group" class="col-xl-7 offset-xl-3" style="margin-top: 15px">
        <label style="color: white">Wybierz cel diety</label>
        <select class="custom-select" formControlName="dietTarget" required>
          <option value="0">Utrzymanie wagi</option>
          <option value="2">Nabranie wagi</option>
          <option value="1">Redukcja wagi</option>
        </select>
      </div>
      <div class="row">
        <div class="col-xl-3 offset-xl-5" style="margin-top: 15px">
          <h1 style="color:white; font-size: 25px">Podaj swoje wymiary</h1>
        </div>
      </div>
      <div class="form-group" class="col-xl-7 offset-xl-3" style="margin-top: 15px">
        <label for="weight" style="color: white">Ramiona</label>
        <input type="number" class="form-control" placeholder="Ramiona w cm" formControlName="arms" required>
      </div>
      <div class="form-group" class="col-xl-7 offset-xl-3" style="margin-top: 15px">
        <label for="height" style="color: white">Klatka pierśiowa</label>
        <input type="number" class="form-control" placeholder="Klatka pierśiowa w cm" formControlName="chest" required>
      </div>
      <div class="form-group" class="col-xl-7 offset-xl-3" style="margin-top: 15px">
        <label for="age" style="color: white">Uda</label>
        <input type="number" class="form-control" placeholder="Uda" formControlName="thig" required>
      </div>
      <div class="form-group" class="col-xl-7 offset-xl-3" style="margin-top: 15px">
        <label for="age" style="color: white">Talia</label>
        <input type="number" class="form-control" placeholder="Taliaw cm" formControlName="waist" required>
      </div>
      <div class="form-group" class="col-xl-7 offset-xl-3" style="margin-top: 15px">
        <label for="age" style="color: white">Pośladki</label>
        <input type="number" class="form-control" placeholder="Pośladki w cm" formControlName="buttocks" required>
      </div>

      <div class="col-xl-2 offset-xl-9" style="margin-top: 15px">
        <button class="btn btn-primary" [disabled]="dietForm.invalid" type="submit" (click)="createDiet()">Wyślij formularz</button>
      </div>
    </div>

  </form>

  <div *ngIf="dietExists">
    <div class="row">
      <div class="col-xl-10 offset-xl-2">
        <p style="color:white; font-size: 35px; font-style: italic">Kcal: {{currentDiet.Kcal}}, Białko: {{currentDiet.Protein}}g, Tłuszcze: {{currentDiet.Fat}}g, Węglowodany: {{currentDiet.Carbohydrates}}g</p>
      </div>
    </div>
    <div class="row">
      <div class="col-xl-9 offset-xl-3" style="margin-top: 15px">
        <p style="color:white; font-size: 35px">Wybierz posiłek, aby dowiedzieć się więcej</p>
      </div>
      <div *ngIf="currentDiet.Meals.length > 4" class="col-xl-9 offset-xl-2">
        <button class="btn btn-dark btn-lg" (click)="displayMealTable(0)">Śniadanie</button>
        <button class="btn btn-dark btn-lg" (click)="displayMealTable(1)">Obiad</button>
        <button class="btn btn-dark btn-lg" (click)="displayMealTable(2)">Posiłek przed treningowy</button>
        <button class="btn btn-dark btn-lg" (click)="displayMealTable(3)">Posiłek po treningowy</button>
        <button class="btn btn-dark btn-lg" (click)="displayMealTable(4)">Kolacja</button>
      </div>
      <div *ngIf="currentDiet.Meals.length == 4" class="col-xl-9 offset-xl-2">
        <button class="btn btn-dark btn-lg" (click)="displayMealTable(0)">Śniadanie</button>
        <button class="btn btn-dark btn-lg" (click)="displayMealTable(1)">Posiłek przed treningowy</button>
        <button class="btn btn-dark btn-lg" (click)="displayMealTable(2)">Posiłek po treningowy</button>
        <button class="btn btn-dark btn-lg" (click)="displayMealTable(3)">Kolacja</button>
      </div>

    </div>

    <div *ngIf="showMeal" style="margin-top: 15px">
      <div class="row">

        <div class="col-xl-9 offset-xl-2">
          <p style="color:white; font-size: 35px">Ilość kalorii w posiłku: {{meals[numberOfMeal].Kcal}}</p>
          <p style="color:white; font-size: 35px">Makroskładniki: B {{meals[numberOfMeal].Protein}}g, T {{(meals[numberOfMeal].Fat)}}g, W {{meals[numberOfMeal].Carbohydrates}}g</p>
        </div>
        <div class="col-xl-3 offset-xl-9">
          <nav class="navbar">
            <input class="form-control" type="text" name="search" placeholder="Wyszukaj" [(ngModel)]="filter">
          </nav>
        </div>
        <div class="col-xl-10 offset-xl-2">
          <table class="table table-striped table-dark">
            <thead>
              <tr>
                <th>Nazwa produktu</th>
                <th>Kategoria produktu</th>
                <th>Kcal na 100g</th>
                <th>Ilość w posiłku</th>
                <th>Konfiguruj posiłek</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of products.product | filter:filter | paginate: { itemsPerPage: 5, currentPage: p }; let i = index">
                <th>{{product.Name}}</th>
                <td>{{product.Category}}</td>
                <td>{{product.NutritionalValue}}</td>
                <td *ngIf="product.Category== 'Białko' "> {{((meals[numberOfMeal].Protein * 4)/product.NutritionalValue) * 100}}g</td>
                <td *ngIf="product.Category== 'Tłuszcze' "> {{((meals[numberOfMeal].Fat * 9)/product.NutritionalValue) * 100}}g</td>
                <td *ngIf="product.Category== 'Węglowodany' "> {{((meals[numberOfMeal].Carbohydrates * 4)/product.NutritionalValue) * 100}}g</td>
                <td><button *ngIf="product.Category== 'Białko' && proteinType == true || product.Category== 'Tłuszcze' && fatType == true || product.Category== 'Węglowodany' && carbohydratesType == true " class="btn btn-primary" type="submit"  (click)="openModal(Meal)" (click)="addProductToMealList(product)">Dodaj do posiłku</button></td>
              </tr>
            </tbody>
            <pagination-controls (pageChange)="p = $event"></pagination-controls>
          </table>
        </div>
      </div>
    </div>
    <button class="btn btn-primary" type="submit" (click)="showHistory()">Pokaż historie</button>
  </div>
</div>


<ng-template #Meal>
  <div class="modal-header">
      <h4 class="modal-title pull-left">
        <b style="font-size: 30px">Ilość kalorii w posiłku: {{meals[numberOfMeal].Kcal}}</b>
      </h4>
      <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
          <span aria-hidden="true">&times;</span>
      </button>
  </div>
  <div class="modal-body">
          <table class="table">
            <thead>
              <tr>
                <th>Nazwa produktu</th>
                <th>Ilość</th>
                <th>Usuń produkt</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of selectedProduct">
                <th>{{product.Name}}</th>
                <td *ngIf="product.Category== 'Białko' "> {{((meals[numberOfMeal].Protein * 4)/product.NutritionalValue) * 100}}g</td>
                <td *ngIf="product.Category== 'Tłuszcze' "> {{((meals[numberOfMeal].Fat * 9)/product.NutritionalValue) * 100}}g</td>
                <td *ngIf="product.Category== 'Węglowodany' "> {{((meals[numberOfMeal].Carbohydrates * 4)/product.NutritionalValue) * 100}}g</td>
                <td><button class="btn btn-danger" type="submit"  (click)="deleteProduct(product)">Usuń</button></td>
              </tr>
            </tbody>
          </table>
          <button class="btn btn-primary btn-lg" (click)="modalRef.hide()" (click)="sendMessageMeal()">Wyślij</button>
  </div>
</ng-template>
